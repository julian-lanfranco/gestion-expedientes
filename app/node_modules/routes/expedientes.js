var express = require('express');
var bodyParser = require('body-parser');
var expedienteDao = require('dao/expediente');
var listaExpedientes = [];
 
var router = express.Router();
router.use(bodyParser.json());
 
router.route('/')
    .get(function (req, res, next) {
        expedienteDao.buscarTodos(
            function(resultado){
                res.setHeader('Content-Type', 'application/json');
                res.send(JSON.stringify(resultado));
                res.end();
            });
    })
    .post(function (req, res, next) {
        expedienteDao.insertar(
            req.body,function(resultado){
                res.setHeader('Content-Type', 'application/json');
                res.send(JSON.stringify(resultado));
                res.end();
        });
    })
    .put(function (req, res, next) {
        expedienteDao.actualizar(
            req.body,function(resultado){
                res.setHeader('Content-Type', 'application/json');
                res.send(JSON.stringify(resultado));
                res.end();
        });
    })
    .delete(function (req, res, next) {
        console.log(req.body);
        res.send(501);
        res.end();
        /*expedienteDao.borrar(
            req.body,function(resultado){
                res.setHeader('Content-Type', 'application/json');
                res.send(JSON.stringify(resultado));
                res.end();
        });*/
    });
router.route('/:id')
    .get(function (req, res, next) {
    var id = req.params['id'];
    if (id){
        expedienteDao.buscar(
            id,
            function(data){
                res.setHeader('Content-Type', 'application/json');
                res.write(JSON.stringify(data));
                res.end();
            }
        );
    }
    else {
        res.send(404, { status: 'Not found' });
    }
})
    .delete(function (req, res, next) {
        var id = req.params['id'];
        if (id){
        expedienteDao.borrar(id,
            function(resultado){
                res.send(204);
                res.end();
                });
        }
    })
.all(function (req, res, next) {  /// para todos los dem√°s no implementado
    res.send(501, { status: 'Not implemented' });
});
 
module.exports = router;